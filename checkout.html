<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Home Cooked Meals</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="icon" href="public/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="public/favicon.ico" type="image/x-icon">
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
        /* --- Base & Layout --- */
        body.checkout-page { background-color: #f8f9fa; }
        .checkout-container-wrapper { display: flex; justify-content: center; align-items: flex-start; min-height: calc(100vh - 180px); padding: 40px 20px; }
        .checkout-container { background-color: #ffffff; border-radius: 12px; padding: 35px 40px; width: 100%; max-width: 700px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08); border: 1px solid #e9ecef; }
        .checkout-title { text-align: center; margin-bottom: 35px; font-size: 26px; font-weight: 600; color: #343a40; }

        /* --- Content Switching --- */
        #checkout-content > .content-section {
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }
        #checkout-content > .content-section.hidden {
            opacity: 0;
            height: 0; /* Collapse height when hidden */
            overflow: hidden; /* Prevent content spillover */
            pointer-events: none; /* Disable interaction */
            /* Remove margin/padding when hidden */
            margin-top: 0;
            margin-bottom: 0;
            padding-top: 0;
            padding-bottom: 0;
            border: none; /* Remove borders when hidden */
        }

        /* --- Form Styling --- */
        .checkout-form-section { margin-bottom: 30px; padding-bottom: 30px; border-bottom: 1px solid #f1f3f5; }
        .checkout-form-section:last-of-type { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }
        .section-heading { font-size: 1.1rem; font-weight: 600; color: #495057; margin-bottom: 20px; border-left: 3px solid #774ae4; padding-left: 10px;}
        .form-group { margin-bottom: 18px; }
        .form-label { display: block; margin-bottom: 7px; font-size: 0.9rem; font-weight: 500; color: #495057; }
        .form-input { width: 100%; padding: 11px 14px; border: 1px solid #ced4da; border-radius: 8px; font-size: 0.95rem; font-family: inherit; transition: border-color 0.2s ease, box-shadow 0.2s ease; background-color: #fff; }
        .form-input:focus { border-color: #774ae4; box-shadow: 0 0 0 3px rgba(119, 74, 228, 0.15); outline: none; }
        .form-input::placeholder { color: #adb5bd; }
         /* Style for invalid inputs */
        .form-input.is-invalid { border-color: #dc3545; box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.15);}

        .form-row-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        /* Enhanced Radio button styling */
        .radio-group { display: flex; gap: 15px; flex-wrap: wrap; }
        .radio-option { display: flex; align-items: center; background-color: #fff; border: 1px solid #dee2e6; border-radius: 8px; padding: 12px 18px; cursor: pointer; transition: all 0.2s ease; flex-grow: 1; justify-content: center; }
        .radio-option:hover { border-color: #adb5bd; background-color: #f8f9fa;}
        .radio-option input[type="radio"] { margin-right: 10px; accent-color: #774ae4; width: 16px; height: 16px;}
        .radio-option span { font-size: 0.95rem; font-weight: 500; color: #495057; }
        .radio-option:has(input:checked) { border-color: #774ae4; background-color: #f3efff; box-shadow: 0 0 8px rgba(119, 74, 228, 0.1); }
        .radio-option:has(input:checked) span { color: #5a36b4; font-weight: 600; }


        /* Sections to hide/show */
        .hidden-section { display: none; margin-top: 20px; padding-top: 20px; border-top: 1px dashed #e0e0e0;}
        .hidden-section.visible { display: block; }

        /* Order Summary */
         .order-total-display { text-align: right; margin: 25px 0; font-size: 1.1rem; padding-top: 15px; border-top: 1px solid #e9ecef; }
         .order-total-display strong { font-weight: 600; color: #343a40; margin-left: 10px; font-size: 1.2rem;}

        /* Submit Button */
        .submit-button { display: inline-flex; align-items: center; justify-content: center; width: 100%; padding: 14px; background-color: #774ae4; color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 10px rgba(119, 74, 228, 0.2); margin-top: 10px; }
        .submit-button:hover { background-color: #5a36b4; box-shadow: 0 6px 12px rgba(119, 74, 228, 0.3); }
        .submit-button:disabled { background-color: #adb5bd; cursor: not-allowed; box-shadow: none; }
         /* Spinner inside button */
         .submit-button .spinner {
             display: inline-block;
             width: 18px;
             height: 18px;
             border: 2px solid rgba(255, 255, 255, 0.3);
             border-radius: 50%;
             border-top-color: #fff;
             animation: spin 1s ease-in-out infinite;
             margin-right: 8px;
         }
         .submit-button .button-text { line-height: 1; }
         @keyframes spin { to { transform: rotate(360deg); } }

        /* Confirmation Screen */
        .confirmation-container { text-align: center; padding: 40px 20px; }
        .confirmation-icon { font-size: 4rem; color: #28a745; margin-bottom: 25px; transform: scale(0.9); animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards; }
        @keyframes popIn { 0% { transform: scale(0.8); opacity: 0;} 100% { transform: scale(1); opacity: 1;} }
        .confirmation-title { font-size: 1.8rem; font-weight: 600; color: #343a40; margin-bottom: 15px; }
        .confirmation-message { font-size: 1rem; color: #495057; line-height: 1.6; margin-bottom: 30px; }
        .confirmation-message strong { color: #343a40; font-weight: 600;}
        .confirmation-actions a { display: inline-block; color: #fff; background-color: #774ae4; padding: 12px 24px; text-decoration: none; border-radius: 8px; font-size: 0.95rem; font-weight: 500; transition: all 0.2s; margin: 5px;}
        .confirmation-actions a:hover { background-color: #5a36b4; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1);}

        /* Loading/Error */
        .loading-error-message { text-align: center; padding: 50px 20px; font-size: 1.1rem; color: #6c757d; }

        /* Responsive */
        @media (max-width: 576px) {
            .checkout-container { padding: 25px; }
            .checkout-title { font-size: 22px; }
            .form-row-grid { grid-template-columns: 1fr; }
            .radio-group { flex-direction: column; align-items: stretch; }
            .confirmation-title { font-size: 1.6rem;}
        }
    </style>
</head>
<body class="checkout-page">
    <div class="home">
        <!-- Header -->
        <header class="header">
           <div class="container">
                 <a href="index.html" class="logo-container" style="text-decoration: none;">
                    <i class="logo-icon fa-solid fa-leaf"></i>
                    <span class="logo-text">Home Cooked Meals</span>
                </a>
                <div class="nav-cart-container">
                    <nav class="navigation">
                        <ul class="navigation-pill-list">
                            <li><a href="index.html" class="navigation-pill">Home</a></li>
                            <li><a href="menu.html" class="navigation-pill">Menu</a></li>
                            <li><a href="locations.html" class="navigation-pill">Locations</a></li>
                            <li><a href="auth.html" class="navigation-pill">Login</a></li>
                        </ul>
                    </nav>
                    <div class="cart-container">
                        <a href="cart.html" aria-label="View Cart">
                            <i class="simple-cart fa-solid fa-cart-shopping"></i>
                            <span id="cart-count">0</span>
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main>
            <div class="checkout-container-wrapper">
                <div class="checkout-container">

                    <!-- Wrapper for dynamic content -->
                    <div id="checkout-content">

                        <!-- Loading State (visible initially) -->
                        <div class="loading-error-message content-section">Loading checkout details...</div>

                        <!-- Checkout Form (hidden initially) -->
                        <form id="checkout-form" class="content-section hidden">
                             <h1 class="checkout-title">Checkout</h1>
                            <!-- Delivery Method -->
                            <fieldset class="checkout-form-section"> <legend class="section-heading">Delivery Method</legend> <div class="radio-group" id="delivery-method"> <label class="radio-option"> <input type="radio" name="deliveryType" value="pickup" checked> <span><i class="fa-solid fa-store" style="margin-right: 5px;"></i> Pick-up</span> </label> <label class="radio-option"> <input type="radio" name="deliveryType" value="delivery"> <span><i class="fa-solid fa-truck" style="margin-right: 5px;"></i> Delivery</span> </label> </div> </fieldset>
                            <!-- Address Section -->
                            <section id="address-section" class="checkout-form-section hidden-section"> <h3 class="section-heading">Shipping Address</h3> <div class="form-group"> <label for="street" class="form-label">Street Address</label> <input type="text" id="street" class="form-input" name="street" autocomplete="street-address"> </div> <div class="form-group"> <label for="city" class="form-label">City</label> <input type="text" id="city" class="form-input" name="city" autocomplete="address-level2"> </div> <div class="form-row-grid"> <div class="form-group"> <label for="zip" class="form-label">ZIP / Postal Code</label> <input type="text" id="zip" class="form-input" name="zip" autocomplete="postal-code"> </div> <div class="form-group"> <label for="country" class="form-label">Country</label> <input type="text" id="country" class="form-input" name="country" autocomplete="country-name"> </div> </div> </section>
                            <!-- Payment Method -->
                            <fieldset class="checkout-form-section"> <legend class="section-heading">Payment Method</legend> <div class="radio-group" id="payment-method"> <label class="radio-option"> <input type="radio" name="paymentType" value="Card" checked> <span><i class="fa-regular fa-credit-card" style="margin-right: 5px;"></i> Credit Card</span> </label> <label class="radio-option"> <input type="radio" name="paymentType" value="PayPal"> <span><i class="fa-brands fa-paypal" style="margin-right: 5px;"></i> PayPal</span> </label> </div> </fieldset>
                            <!-- Card Details Section -->
                            <section id="card-details-section" class="checkout-form-section hidden-section visible"> <h3 class="section-heading">Card Details</h3> <div class="form-group"> <label for="card-number" class="form-label">Card Number</label> <input type="text" id="card-number" class="form-input" name="cardNumber" placeholder="•••• •••• •••• ••••" inputmode="numeric" pattern="[\d ]{16,19}" autocomplete="cc-number" title="Enter 16-19 digit card number"> </div> <div class="form-group"> <label for="card-name" class="form-label">Name on Card</label> <input type="text" id="card-name" class="form-input" name="cardName" autocomplete="cc-name"> </div> <div class="form-row-grid"> <div class="form-group"> <label for="card-expiry" class="form-label">Expiry Date (MM/YY)</label> <input type="text" id="card-expiry" class="form-input" name="cardExpiry" placeholder="MM/YY" pattern="\d{2}\s?\/\s?\d{2}" autocomplete="cc-exp" title="Enter expiry date as MM/YY"> </div> <div class="form-group"> <label for="card-cvc" class="form-label">CVC / CVV</label> <input type="text" id="card-cvc" class="form-input" name="cardCvc" placeholder="•••" inputmode="numeric" pattern="\d{3,4}" autocomplete="cc-csc" title="Enter 3 or 4 digit security code"> </div> </div> </section>
                            <!-- Order Total Display -->
                             <div class="order-total-display">Total: <strong id="order-total-value">$0.00</strong></div>
                            <!-- Submit Button -->
                            <button type="submit" class="submit-button" id="place-order-button" disabled>
                                <span class="button-text">Place Order</span>
                                <!-- Spinner initially hidden -->
                                <!-- <span class="spinner" style="display: none;"></span> -->
                            </button>
                        </form>

                        <!-- Confirmation Section (hidden initially) -->
                        <div id="confirmation-section" class="confirmation-container content-section hidden">
                            <div class="confirmation-icon"><i class="fa-solid fa-circle-check"></i></div>
                            <h2 class="confirmation-title">Order Placed Successfully!</h2>
                            <p class="confirmation-message" id="confirmation-text">Your order <strong id="confirmation-order-id">#</strong> is confirmed. <span id="confirmation-delivery-info"></span></p>
                            <div class="confirmation-actions"> <a href="menu.html">Continue Shopping</a> </div>
                        </div>
                    </div> <!-- End #checkout-content -->

                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer"> <div class="container"> <p>© <span id="currentYear">...</span> Home Cooked Meals. All rights reserved.</p> <nav class="footer-nav"> <a href="#">Privacy Policy</a> | <a href="#">Terms of Service</a> </nav> </div> </footer>
    </div>

    <!-- Scripts -->
    <script src="js/header_auth.js"></script>
    <script src="js/api.js"></script>
    <script src="js/checkout_app.js"></script>
    <script src="js/script.js"></script>
</body>
</html>